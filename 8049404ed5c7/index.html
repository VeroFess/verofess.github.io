<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1,minimum-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><meta content="#fff" name="theme-color" id="theme-color"><meta content="威尔的博客" name="description"><link href="/image/common/apple-touch-icon.png" rel="icon"><title>CSharp中实现一个可继承的Singleton基类</title><meta content="CSharp中实现一个可继承的Singleton基类" property="og:title"><meta content="https://blog.binklac.com/8049404ed5c7/index.html" property="og:url"><meta content="/image/common/avatar.png" property="og:img"><meta content="威尔的博客" property="og:img"><meta content="article" property="og:type"><meta content="2022-04-29" property="og:article:published_time"><meta content="2022-04-29" property="og:article:modified_time"><meta content="VeroFess" property="og:article:author"><meta content="CSharp" property="og:article:tag"><script>function loadScript(e,t){var n=document.createElement("script");n.src=e,t&&(n.onload=t),n.async=!0,document.body.appendChild(n)}function loadCSS(e,t,n){var a=document.createElement("link");a.ref="stylesheet",a.href=e,a.dataset[t]=n,document.head.appendChild(a)}function changeCSS(e,t,n){var t=document.querySelector(t),a=document.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("href",e),a.dataset.prism=n,document.head.replaceChild(a,t)}</script><script>var reverseDarkList={dark:"light",light:"dark"},themeColor={dark:"#1c1c1e",light:"#fff"},getCssMediaQuery=function(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},reverseDarkModeSetting=function(){var e=localStorage.getItem("user-color-scheme");if(reverseDarkList[e])e=reverseDarkList[e];else{if(null!==e)return;e=reverseDarkList[getCssMediaQuery()]}return localStorage.setItem("user-color-scheme",e),e}</script><script>var setDarkmode=function(e){e=e||localStorage.getItem("user-color-scheme");e===getCssMediaQuery()?(document.documentElement.removeAttribute("data-user-color-scheme"),localStorage.removeItem("user-color-scheme"),document.getElementById("theme-color").content=themeColor[e],document.getElementById("theme-color").dataset.mode=e):reverseDarkList[e]?(document.documentElement.setAttribute("data-user-color-scheme",e),document.getElementById("theme-color").content=themeColor[e],document.getElementById("theme-color").dataset.mode=e):(document.documentElement.removeAttribute("data-user-color-scheme"),localStorage.removeItem("user-color-scheme"),document.getElementById("theme-color").content=themeColor[getCssMediaQuery()],document.getElementById("theme-color").dataset.mode=getCssMediaQuery())};setDarkmode()</script><link href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" rel="preload" as="style"><link href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" rel="preload" as="style"><link href="/js/lib/lozad.min.js" rel="preload" as="script"><link href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" rel="prefetch" as="script"><link href="/css/main.css" rel="stylesheet"><link href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" rel="stylesheet"><link href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" rel="stylesheet"><meta content="Hexo 6.1.0" name="generator"><link href="/atom.xml" rel="alternate" title="威尔的代码站" type="application/atom+xml"></head><body><div class="wrapper"><nav class="navbar"><div class="navbar-logo"><span class="navbar-logo-main"><img alt="blog logo" class="navbar-logo-img" height="32" src="/image/common/apple-touch-icon.png" width="32"> <span class="navbar-logo-dsc">威尔的代码站</span></span></div><div class="navbar-menu"><a href="/" class="navbar-menu-item">首页 </a><a href="/archives" class="navbar-menu-item">归档 </a><a href="/tags" class="navbar-menu-item">标签 </a><a href="/categories" class="navbar-menu-item">分类 </a><a href="/about" class="navbar-menu-item">关于 </a><a href="/links" class="navbar-menu-item">友链 </a><a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i> </a><a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size:1.2rem;font-weight:400"></i></a></div></nav><div id="local-search" style="display:none"><input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容..."><div id="search-content"></div></div><div class="section-wrap"><div class="container"><div class="columns"><main class="main-column"><article class="card card-content"><header><h1 class="post-title">CSharp中实现一个可继承的Singleton基类</h1></header><div class="post-meta post-show-meta"><time datetime="2022-04-29T03:11:01.243Z"><i class="iconfont icon-calendar" style="margin-right:2px"></i> <span>2022-04-29</span> </time><span class="dot"></span> <a href="/categories/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" class="post-meta-link">开发笔记 </a><span class="dot"></span> <span>303 字</span></div><div class="post-meta post-show-meta" style="margin-top:-10px"><div style="display:flex;align-items:center"><i class="iconfont icon-biaoqian" style="margin-right:2px;font-size:1.15rem"></i> <a href="/tags/CSharp/" class="post-meta-link">CSharp</a></div></div><div class="post-content" id="section"><p>网上大部分的单例实现都要求在类里添加一个”GetInstance()”并且声明私有的构造函数,额外多了几行没啥用且重复的代码,一不小心还会忘记把构造函数搞成私有的,非常不爽,所以就搞了个这东西</p><p>不多说,上代码,使用的时候只需要<code>public class ClassName : Singleton&lt;ClassName&gt;</code>即可,获取实例直接<code>ClassName.Instance</code>,无需额外的更改</p><pre class="highlight"><code class="hljs reasonml">using System;<br>using System.Collections.Generic;<br><br>namespace InstanceHelper.Singleton &#123;<br>    public <span class="hljs-keyword">class</span> Singleton&lt;T&gt; &#123;<br>        <span class="hljs-keyword">private</span> static Dictionary&lt;Type, Object&gt; TypeObjectMap = <span class="hljs-keyword">new</span> Dictionary&lt;Type, Object&gt;<span class="hljs-literal">()</span>;<br>        <span class="hljs-keyword">private</span> static List&lt;Type&gt; TypeLoadList = <span class="hljs-keyword">new</span> List&lt;Type&gt;<span class="hljs-literal">()</span>;<br><br>        static public T Instance &#123;<span class="hljs-function"> <span class="hljs-params">get</span> =&gt;</span> <span class="hljs-constructor">GetInstance(<span class="hljs-params">typeof</span>(T)</span>); &#125;<br><br>        public <span class="hljs-constructor">Singleton()</span> &#123;<br>            lock (TypeLoadList) &#123;<br>                <span class="hljs-keyword">if</span> (!TypeLoadList.<span class="hljs-constructor">Contains(<span class="hljs-params">this</span>.GetType()</span>)) &#123;<br>                    throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">NewSingletonClassException(String.Format(<span class="hljs-string">&quot;Class &#123;0&#125; is Singleton, Use \&quot;&#123;1&#125;.Instance;\&quot; but \&quot;new &#123;1&#125;();\&quot;&quot;</span>, <span class="hljs-params">this</span>.GetType()</span>.FullName, this.<span class="hljs-constructor">GetType()</span>.Name));<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">private</span> static void <span class="hljs-constructor">LockUnregisterTypeLoadStatus(Type <span class="hljs-params">_Type</span>)</span> &#123;<br>            lock (TypeLoadList) &#123;<br>                <span class="hljs-keyword">if</span> (TypeLoadList.<span class="hljs-constructor">Contains(<span class="hljs-params">_Type</span>)</span>) &#123;<br>                    TypeLoadList.<span class="hljs-constructor">Remove(<span class="hljs-params">_Type</span>)</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">private</span> static void <span class="hljs-constructor">LockRegisterTypeLoadStatus(Type <span class="hljs-params">_Type</span>)</span> &#123;<br>            lock (TypeLoadList) &#123;<br>                <span class="hljs-keyword">if</span> (!TypeLoadList.<span class="hljs-constructor">Contains(<span class="hljs-params">_Type</span>)</span>) &#123;<br>                    TypeLoadList.<span class="hljs-constructor">Add(<span class="hljs-params">_Type</span>)</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        protected static T <span class="hljs-constructor">GetInstance(Type <span class="hljs-params">_Type</span>)</span> &#123;<br>            <span class="hljs-keyword">if</span> (!TypeObjectMap.<span class="hljs-constructor">ContainsKey(<span class="hljs-params">_Type</span>)</span>) &#123;<br>                lock (TypeObjectMap) &#123;<br>                    <span class="hljs-keyword">if</span> (!TypeObjectMap.<span class="hljs-constructor">ContainsKey(<span class="hljs-params">_Type</span>)</span>) &#123;<br>                        <span class="hljs-constructor">LockRegisterTypeLoadStatus(<span class="hljs-params">_Type</span>)</span>;<br>                        var Instance = Activator.<span class="hljs-constructor">CreateInstance(<span class="hljs-params">_Type</span>)</span>;<br>                        <span class="hljs-constructor">LockUnregisterTypeLoadStatus(<span class="hljs-params">_Type</span>)</span>;<br>                        TypeObjectMap.<span class="hljs-constructor">Add(<span class="hljs-params">_Type</span>, Instance)</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            return (T)TypeObjectMap<span class="hljs-literal">[<span class="hljs-identifier">_Type</span>]</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div><div><div class="copyright note-info post-note" style="margin-top:42px"><p><span style="font-weight:700">作者：</span><a href="/about" rel="nofollow noopener noreferrer" target="_blank"> VeroFess</a></p><p><span style="font-weight:700">文章链接：</span><a href="https://blog.binklac.com/8049404ed5c7/" rel="nofollow noopener noreferrer" target="_blank"> https://blog.binklac.com/8049404ed5c7/</a></p><p><span style="font-weight:700">版权声明：</span>本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p></div></div></article><div class="nav"><div class="nav-item-prev"><a href="/e6ad4dc21152/" class="nav-link"><i class="iconfont icon-left nav-prev-icon"></i><div><div class="nav-label">上一篇</div><div class="nav-title">一份面向Linux下高版本Java的Minecraft参数优化教程</div></div></a></div></div><div class="card card-content comment-card" style="margin-top:16px"><div class="comment-card-title">评论</div><div id="gitalk-container"></div><link href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" rel="stylesheet"><script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script src="/js/lib/md5.min.js"></script><script>var gitalk=new Gitalk({clientID:"fa33b26af65fe0341b72",clientSecret:"f01690161815f547af7bef238cd1928e5a2744b5",repo:"GitTalkStorage",owner:"VeroFess",admin:["VeroFess"],id:md5(location.href),distractionFreeMode:!1,language:"zh-CN",labels:["Gitalk"],perPage:10});gitalk.render("gitalk-container")</script></div><div class="card card-content toc-card" id="mobiletoc"><div class="toc-header"><i class="iconfont icon-menu" style="padding-right:2px"></i>目录</div></div></main><aside class="left-column"><div class="card card-author"><img alt="author avatar" class="author-img" height="88" src="/image/common/avatar.png" width="88"><p class="author-name">VeroFess</p><p class="author-description">一个通过开发安全工具让系统变得不安全的家伙</p><div class="author-message"><a href="/archives" class="author-posts-count"><span>2</span> <span>文章</span> </a><a href="/categories" class="author-categories-count"><span>1</span> <span>分类</span> </a><a href="/tags" class="author-tags-count"><span>2</span> <span>标签</span></a></div><div class="author-card-society"><div class="author-card-society-icon"><a href="https://github.com/VeroFess" rel="noopener" target="_blank"><i class="iconfont icon-github society-icon"></i></a></div></div></div><div class="sticky-tablet"><article class="display-when-two-columns spacer"><div class="card card-content toc-card"><div class="toc-header"><i class="iconfont icon-menu" style="padding-right:2px"></i>目录</div></div></article><article class="card card-content categories-widget"><div class="categories-card"><div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right:2px"></i>分类</div><div class="categories-list"><a href="/categories/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"><div class="categories-list-item">开发笔记 <span class="categories-list-item-badge">1</span></div></a></div></div></article><article class="card card-content tags-widget"><div class="tags-card"><div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right:2px"></i>热门标签</div><div class="tags-list"><a href="/tags/Minecraft/" title="Minecraft"><div class="tags-list-item">Minecraft</div></a><a href="/tags/CSharp/" title="CSharp"><div class="tags-list-item">CSharp</div></a></div></div></article></div></aside><aside class="right-column"><div class="sticky-widescreen"><article class="card card-content toc-card"><div class="toc-header"><i class="iconfont icon-menu" style="padding-right:2px"></i>目录</div></article><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right:2px"></i>最近文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2022-04-29</div><a href="/e6ad4dc21152/"><div class="recent-posts-item-content">一份面向Linux下高版本Java的Minecraft参数优化教程</div></a></div><div class="recent-posts-item"><div class="recent-posts-item-title">2022-04-29</div><a href="/8049404ed5c7/"><div class="recent-posts-item-content">CSharp中实现一个可继承的Singleton基类</div></a></div></div></div></article></div></aside></div></div></div></div><footer class="footer"><div class="footer-container"><div><div class="footer-dsc"><span>Copyright © 2017 - 2022 </span>&nbsp; <a href="/" class="footer-link">威尔的代码站</a></div></div><div class="footer-dsc">Powered by <a href="https://hexo.io/" class="footer-link" rel="nofollow noopener noreferrer" target="_blank">&nbsp;Hexo </a><span>&nbsp;|&nbsp;</span> Theme - <a href="https://github.com/theme-kaze" class="footer-link" rel="nofollow noopener noreferrer" target="_blank">&nbsp;Kaze</a></div><div class="footer-dsc">本站总访问量<span id="busuanzi_value_site_pv"></span>次 <span>&nbsp;|&nbsp;</span> 本站总访客数<span id="busuanzi_value_site_uv"></span>次</div></div></footer><a class="basebutton" id="scrollbutton" aria-label="回到顶部" role="button"><i class="iconfont button-icon icon-arrowleft"></i> </a><a class="basebutton" id="menubutton" aria-label="menu button" role="button"><i class="iconfont button-icon icon-menu"></i> </a><a class="basebutton" id="popbutton" aria-label="控制中心" role="button"><i class="iconfont button-icon icon-expand"></i> </a><a class="basebutton darkwidget" id="darkbutton" aria-label="夜色模式" role="button"><i class="iconfont button-icon icon-weather"></i> </a><a class="basebutton searchwidget" id="searchbutton" aria-label="搜索" role="button"><i class="iconfont button-icon icon-search"></i></a><script src="/js/main.js"></script><script>loadScript("/js/lib/busuanzi.min.js")</script><script>var addLazyload=function(){lozad(".lozad",{load:function(a){a.srcset=a.getAttribute("data-src")},loaded:function(a){a.classList.add("loaded")}}).observe()}</script><script>loadScript("/js/lib/lozad.min.js",addLazyload)</script><script>var googleAnalytics=function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-YYWB3PMXXN")}</script><script>loadScript("https://www.googletagmanager.com/gtag/js?id=G-YYWB3PMXXN",googleAnalytics)</script><script>setTimeout(()=>{localSearch("search.json")},0)</script></body></html>